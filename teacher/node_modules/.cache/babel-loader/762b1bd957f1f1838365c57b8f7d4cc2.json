{"ast":null,"code":"export default {\n  data() {\n    return {\n      dialogVisible: false,\n      user: localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : {},\n      photo: '',\n      classes: [],\n      form: {},\n      rules: {\n        oldPassword: [{\n          required: true,\n          message: '请输入旧密码',\n          trigger: 'blur'\n        }, {\n          min: 4,\n          max: 12,\n          message: '密码长度在 4 到 12 个字符',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入新密码',\n          trigger: 'blur'\n        }, {\n          min: 4,\n          max: 12,\n          message: '密码长度在 4 到 12 个字符',\n          trigger: 'blur'\n        }],\n        confirmPassword: [{\n          required: true,\n          message: '请确定密码',\n          trigger: 'blur'\n        }, {\n          min: 4,\n          max: 12,\n          message: '密码长度在 4 到 12 个字符',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.load();\n  },\n  methods: {\n    load() {\n      this.request.get(\"/service-class/class/page\", {\n        params: {\n          teaName: this.user.truename,\n          pageNum: 1,\n          pageSize: 100\n        }\n      }).then(res => {\n        // console.log(res.data.records[0].className)\n        this.classes = res.data.records;\n      });\n    },\n    //修改头像\n    handleAvatarSuccess(res) {\n      // console.log(res)\n      for (let i = 0; i < res.data.length; i++) {\n        this.photo = res.data[i].url;\n        console.log(this.photo, 'url');\n      }\n      this.request.post(\"/service-user/user\", {\n        id: this.user.id,\n        avatar: this.photo\n      }).then(res => {\n        if (res.code === '200') {\n          //console.log(res)\n          this.$message.success(\"更改头像成功!\");\n          //更新浏览器缓存user\n          this.user.avatar = this.photo;\n          localStorage.setItem(\"user\", JSON.stringify(this.user));\n          //触发父级Main.vue,更新user\n          this.$emit(\"refrehUser\");\n        } else {\n          this.$message.error(\"更改头像失败！\");\n        }\n      });\n    },\n    //修改密码按钮\n    changePassword() {\n      this.dialogVisible = true;\n    },\n    //修改密码弹窗的确定按钮\n    savePassword() {\n      this.$refs['userForm'].validate(valid => {\n        if (valid) {\n          if (this.form.oldPassword !== this.user.password) {\n            this.$message.error(\"您输入的旧密码错误！\");\n            this.dialogVisible = true;\n          } else if (this.form.password !== this.form.confirmPassword) {\n            this.$message.error(\"您输入的新密码与再次输入的新密码不一致！\");\n            this.dialogVisible = true;\n          } else {\n            this.request.post(\"/service-user/user\", {\n              id: this.user.id,\n              password: this.form.password\n            }).then(res => {\n              if (res.code === '200') {\n                this.$message.success(\"修改密码成功！\");\n                this.dialogVisible = false;\n                //更新浏览器缓存user\n                this.user.password = this.form.password;\n                localStorage.setItem(\"user\", JSON.stringify(this.user));\n                //触发父级Main.vue,更新user\n                this.$emit(\"refrehUser\");\n              } else {\n                this.$message.error(\"修改密码失败！\");\n              }\n\n              // this.$refs.userForm.resetFields();//重置输入框\n            });\n          }\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"AA+DA;EACAA;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC,cACA;UAAAC;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,EACA;QACAG,WACA;UAAAL;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,EACA;QACAI,kBACA;UAAAN;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA;MAEA;IACA;EACA;EACAK;IACA;EACA;EACAC;IACAC;MACA;QACAC;UACAC;UACAC;UACAC;QACA;MACA;QACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;QACA;QACAC;MACA;MAEA;QACAC;QACAC;MACA;QACA;UACA;UACA;UACA;UACA;UACAC;UACA;UACA;QACA;UACA;QACA;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACA;QACA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;YACA;cACAJ;cACAX;YACA;cACA;gBACA;gBACA;gBACA;gBACA;gBACAa;gBACA;gBACA;cACA;gBACA;cACA;;cAEA;YACA;UACA;QACA;MACA;IAEA;EACA;AACA","names":["data","dialogVisible","user","photo","classes","form","rules","oldPassword","required","message","trigger","min","max","password","confirmPassword","created","methods","load","params","teaName","pageNum","pageSize","handleAvatarSuccess","console","id","avatar","localStorage","changePassword","savePassword"],"sourceRoot":"src/views","sources":["Person.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-card class=\"box-card\">\r\n            <el-col :span=\"10\" >              \r\n                <el-avatar    :src=\"this.user.avatar\" ></el-avatar>\r\n                <div>\r\n                    <el-upload\r\n                        class=\"avatar-uploader\"\r\n                        action=\"http://localhost:9090/service-coustype/file/upload\"\r\n                        :show-file-list=\"false\"     \r\n                                         \r\n                        :on-success=\"handleAvatarSuccess\" style=\"float: left;\">\r\n\r\n                        <el-button type=\"success\" plain>更换头像</el-button>\r\n                    </el-upload>\r\n                    <el-button style=\"margin-left:20px ;\" type=\"warning\" @click=\"changePassword\" plain>修改密码</el-button>\r\n                </div>\r\n                \r\n            </el-col>\r\n            <el-col :span=\"14\">\r\n                <el-descriptions size=\"medium\" :title=\"user.truename\" :column=\"1\" >\r\n                    <el-descriptions-item  label=\"所教班级\" >\r\n                        <template v-for=\"item in classes\" >\r\n                            <span>{{item.className}}，</span>\r\n                        </template>\r\n                    </el-descriptions-item>                   \r\n                </el-descriptions>\r\n            </el-col>\r\n        </el-card>\r\n\r\n        <!-- 修改密码弹窗 -->\r\n        <el-dialog \r\n            title=\"修改密码\"\r\n            :visible.sync=\"dialogVisible\"\r\n            width=\"26%\" center>\r\n\r\n            <el-form :model=\"form\" :rules=\"rules\" ref=\"userForm\" >\r\n                <el-form-item  >\r\n                 <el-input size=\"medium\" :disabled=\"true\" prefix-icon=\"el-icon-user\"  v-model=\"user.username\" autocomplete=\"off\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item prop=\"oldPassword\" >\r\n                    <el-input size=\"medium\"  prefix-icon=\"el-icon-lock\"  v-model=\"form.oldPassword\" placeholder=\"请输入旧密码\" show-password autocomplete=\"off\"></el-input>\r\n                  </el-form-item>\r\n                <el-form-item prop=\"password\" >\r\n                  <el-input size=\"medium\"  prefix-icon=\"el-icon-lock\"  v-model=\"form.password\" placeholder=\"请输入新密码\" show-password autocomplete=\"off\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item prop=\"confirmPassword\" >\r\n                  <el-input size=\"medium\"  prefix-icon=\"el-icon-lock\" v-model=\"form.confirmPassword\" placeholder=\"请确定新密码\" show-password  autocomplete=\"off\"></el-input>\r\n                </el-form-item>\r\n              </el-form>\r\n              \r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n                <el-button type=\"primary\" @click=\"savePassword\">确 定</el-button>\r\n            </span>\r\n        </el-dialog>\r\n\r\n    </div>\r\n       \r\n\r\n   \r\n</template>\r\n<script>\r\nexport default{\r\n    data () {\r\n        return {\r\n            dialogVisible: false,\r\n            user: localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : {},\r\n            photo: '',\r\n            classes: [],\r\n            form:{},\r\n            rules: {\r\n                oldPassword: [\r\n                    {required: true, message: '请输入旧密码', trigger: 'blur'},\r\n                    {min: 4, max: 12, message: '密码长度在 4 到 12 个字符', trigger: 'blur'}\r\n                ],\r\n                password: [\r\n                    {required: true, message: '请输入新密码', trigger: 'blur'},\r\n                    {min: 4, max: 12, message: '密码长度在 4 到 12 个字符', trigger: 'blur'}\r\n                ],\r\n                confirmPassword: [\r\n                     {required: true, message: '请确定密码', trigger: 'blur'},\r\n                    {min: 4, max: 12, message: '密码长度在 4 到 12 个字符', trigger: 'blur'}\r\n                ],\r\n            }\r\n        }\r\n    },\r\n    created(){\r\n        this.load()\r\n    },\r\n    methods: {\r\n        load(){\r\n            this.request.get(\"/service-class/class/page\",{\r\n                params: {\r\n                    teaName: this.user.truename,\r\n                    pageNum: 1,\r\n                    pageSize: 100,\r\n                }\r\n            }).then(res => {\r\n                // console.log(res.data.records[0].className)\r\n                this.classes = res.data.records\r\n            })\r\n        },\r\n       \r\n        //修改头像\r\n        handleAvatarSuccess(res){\r\n            // console.log(res)\r\n            for (let i=0 ;i< res.data.length ;i++){\r\n              this.photo = res.data[i].url\r\n              console.log(this.photo,'url')\r\n            }     \r\n            \r\n            this.request.post(\"/service-user/user\",{\r\n                id:this.user.id,\r\n                avatar:  this.photo\r\n            }).then(res => {\r\n                if(res.code === '200'){\r\n                    //console.log(res)\r\n                    this.$message.success(\"更改头像成功!\")\r\n                    //更新浏览器缓存user\r\n                    this.user.avatar = this.photo\r\n                    localStorage.setItem(\"user\",JSON.stringify(this.user))\r\n                    //触发父级Main.vue,更新user\r\n                    this.$emit(\"refrehUser\")\r\n                }else{\r\n                    this.$message.error(\"更改头像失败！\")\r\n                }\r\n            })\r\n        },\r\n         //修改密码按钮\r\n        changePassword(){\r\n            this.dialogVisible = true\r\n        },\r\n        //修改密码弹窗的确定按钮\r\n        savePassword(){\r\n            this.$refs['userForm'].validate((valid) => {\r\n                if(valid){\r\n                    if(this.form.oldPassword !== this.user.password){\r\n                        this.$message.error(\"您输入的旧密码错误！\")      \r\n                        this.dialogVisible = true                 \r\n                    }else if(this.form.password !== this.form.confirmPassword){\r\n                        this.$message.error(\"您输入的新密码与再次输入的新密码不一致！\")      \r\n                        this.dialogVisible = true \r\n                    }else{\r\n                        this.request.post(\"/service-user/user\",{\r\n                            id:this.user.id,\r\n                            password: this.form.password\r\n                        }).then(res => {\r\n                            if(res.code === '200'){\r\n                                this.$message.success(\"修改密码成功！\") \r\n                                this.dialogVisible = false \r\n                                //更新浏览器缓存user\r\n                                this.user.password = this.form.password\r\n                                localStorage.setItem(\"user\",JSON.stringify(this.user))\r\n                                //触发父级Main.vue,更新user\r\n                                this.$emit(\"refrehUser\")\r\n                            }else{\r\n                                this.$message.error(\"修改密码失败！\") \r\n                            }\r\n                            \r\n                            // this.$refs.userForm.resetFields();//重置输入框\r\n                        })                      \r\n                    }                 \r\n                }\r\n            })\r\n           \r\n        }\r\n    }\r\n}\r\n    \r\n</script>\r\n<style lang=\"less\" scoped>\r\n.box-card {\r\n    width: 60%;\r\n    margin: auto;\r\n    padding: 20px;\r\n    .el-col{\r\n        /deep/.el-descriptions{\r\n            font-size: 18px;\r\n            .el-descriptions__title{\r\n                font-size: 22px;\r\n            }\r\n            .el-descriptions-item__content{\r\n                display: flex;\r\n                flex-wrap: wrap;\r\n            }\r\n        }\r\n        .el-avatar{\r\n            width: 200px;\r\n            height: 200px;\r\n            margin-bottom: 20px;\r\n        }\r\n    }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}