{"ast":null,"code":"//导入Sortable组件\nimport Sortable from 'sortablejs';\nexport default {\n  //注册Sortable组件\n  components: {\n    // eslint-disable-next-line vue/no-unused-components\n    Sortable\n  },\n  data() {\n    return {\n      videolength: 0,\n      //视频时长\n      hide: '',\n      //隐藏样式\n      show: '',\n      //显示样式\n      keys: '',\n      drag: false,\n      hour: '',\n      //时\n      minute: '',\n      //分钟\n      second: '',\n      //秒\n      chaTitle: '',\n      //章节名称\n      tableData: [],\n      dialogVisibleAdd: false,\n      //新增课程弹窗\n      dialogVisibleEdit: false,\n      //修改课程弹窗\n      dialogVisiblePlay: false,\n      //播放\n      chaNunber: 0,\n      //章节数\n      form: {},\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n      courseData: {},\n      rules: {\n        //新增弹窗表单验证\n        chaIndex: [{\n          required: true,\n          message: '请输入章节序号',\n          trigger: 'blur'\n        }, {\n          type: 'number',\n          message: '章节序号必须为数字值'\n        }],\n        chaTitle: [{\n          required: true,\n          message: '请输入章节名称',\n          trigger: 'blur'\n        }],\n        chaUrl: [{\n          required: true,\n          message: '请输入视频地址',\n          trigger: 'blur'\n        }],\n        minute: [{\n          required: true,\n          message: '请输入视频时长',\n          trigger: 'blur'\n        }]\n      },\n      video: {\n        // 视频播放源\n        url: '',\n        // 视频海报\n        // cover: 'https://i.loli.net/2019/06/06/5cf8c5d9c57b510947.png',\n        muted: false,\n        // 是否静音播放\n        loop: false,\n        // 视频是否循环播放\n        preload: 'auto',\n        // 视频预加载\n        poster: '',\n        // 原生视频默认海报暂不设置\n        volume: 1,\n        // 默认音量\n        autoplay: false // 视频自动播放\n      }\n    };\n  },\n\n  mounted() {\n    this.rowDrop(); //列表行拖拽后顺序数组\n  },\n\n  created() {\n    this.courseData = JSON.parse(this.$route.query.courseData);\n    this.chaNunber = this.courseData.couChaNum;\n    this.hide = false;\n    console.log(this.hide);\n    this.show = true;\n    this.load();\n    console.log(this.courseData.teaName, this.user.truename);\n  },\n  computed: {\n    $video() {\n      return this.$refs.vueMiniPlayer.$video;\n    }\n  },\n  methods: {\n    load() {\n      this.request.get(\"/service-chapter/chapter/allchapter\", {\n        params: {\n          courseId: this.courseData.couId,\n          chaTitle: this.chaTitle\n        }\n      }).then(res => {\n        //console.log(res,'res')\n        this.tableData = res.data;\n        this.rowDrop();\n      });\n    },\n    //刷新\n    reast() {\n      this.chaTitle = '';\n      this.load();\n    },\n    //新增章节按钮\n    addChapter() {\n      this.dialogVisibleAdd = true;\n    },\n    //新增章节弹窗确定按钮\n    saveChapter() {\n      this.$refs['chapterFrom'].validate(valid => {\n        if (valid) {\n          var audio = new Audio(this.form.chaUrl);\n          let that = this;\n          // eslint-disable-next-line no-unused-vars\n          audio.addEventListener(\"loadedmetadata\", function (e) {\n            that.form.chaTime = Math.floor(audio.duration); // 通过添加监听来获取视频总时长字段，即duration\n            console.log('视频时长为', that.form.chaTime);\n          });\n          this.form.courseId = this.courseData.couId; //课程id\n          //this.form.chaTime = this.hour*3600 + this.minute*60 + this.second*1,//视频时长\n          this.request.post(\"/service-chapter/chapter\", this.form).then(res => {\n            if (res.code === '200') {\n              this.dialogVisibleAdd = false;\n              this.$message.success(\"新增章节成功！！！\");\n              this.$refs[form].resetFields();\n              this.keys = Math.random(); //用于改变key，使得视图重新渲染\n              this.load();\n              this.form = {};\n              this.hour = '';\n              this.minute = '', this.second = '';\n            } else {\n              this.$message.error(\"新增章节失败！！！\");\n            }\n          });\n\n          // //修改章节数\n          // if(!this.form.chaId){\n          //   this.chaNunber++\n          //   this.request.post(\"/service-course/course\",{\n          //     couId: this.courseData.couId,\n          //     couCataNum: this.chaNunber\n          //   }).then(res => {\n          //\n          //   })\n          // }\n        }\n      });\n    },\n\n    //新增章节弹窗关闭按钮\n    handleClose(done) {\n      this.form = {};\n      this.hour = '';\n      this.minute = '';\n      this.second = '';\n      done();\n    },\n    //修改章节按钮\n    editChapter(row) {\n      this.form = row;\n      this.hour = Math.floor(row.chaTime / 3600);\n      this.minute = Math.floor(row.chaTime % 3600 / 60);\n      this.second = row.chaTime % 60;\n      //console.log(row.chaTime,this.hour,this.minute,this.second)\n      this.dialogVisibleAdd = true;\n    },\n    //删除章节按钮\n    deleteChapter(chaId) {\n      this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.request.delete(\"/service-chapter/chapter/\" + chaId).then(res => {\n          if (res.code === '200') {\n            this.$message.success(\"删除成功！！！\");\n            this.keys = Math.random(); //用于改变key，使得视图重新渲染\n            this.load();\n          } else {\n            this.$message.error(\"删除失败！！！！\");\n          }\n        });\n\n        //修改章节数\n        // this.chaNunber = this.chaNunber - 1\n        // //console.log(this.chaNunber,'删除章节数')\n        // this.request.post(\"/service-course/course\", {\n        //   couId: this.courseData.couId,\n        //   couCataNum: this.chaNunber\n        // }).then(res => {\n        //\n        // })\n      }).catch(() => {\n        this.$message.info(\"已取消删除\");\n      });\n    },\n    //获取视频时长\n    length() {\n      var audio = new Audio(this.form.chaUrl);\n      let that = this;\n      // eslint-disable-next-line no-unused-vars\n      audio.addEventListener(\"loadedmetadata\", function (e) {\n        that.videolength = Math.floor(audio.duration); // 通过添加监听来获取视频总时长字段，即duration\n        console.log('视频时长为:', that.videolength);\n      });\n      that.show = false;\n      that.hide = true;\n    },\n    refresh() {\n      this.show = true;\n      this.hide = false;\n      this.$refs[formRef].resetFields();\n    },\n    //播放\n    play(chaUrl) {\n      this.dialogVisiblePlay = true;\n      this.video.url = chaUrl;\n    },\n    //视频播放\n    handleFullscreen() {},\n    // 行拖拽\n    rowDrop() {\n      const tbody = document.querySelector('.el-table__body-wrapper tbody');\n      Sortable.create(tbody, {\n        // filter: '.filtered',\n        onEnd: ({\n          newIndex,\n          oldIndex\n        }) => {\n          // handle: '.allowDray'\n          // console.log(`newIndex=${newIndex}`,`oldIndex=${oldIndex}`)\n          this.request.get(\"/service-chapter/chapter/drag\", {\n            params: {\n              couId: this.courseData.couId,\n              pageNum: this.pageNum,\n              pageSize: this.pageSize,\n              newIndex: newIndex,\n              oldIndex: oldIndex\n            }\n            // eslint-disable-next-line no-unused-vars\n          }).then(res => {\n            this.keys = Math.random(); //用于改变key，使得视图重新渲染\n            this.load();\n            // _this.$nextTick(() => {\n            //     //重新初始化\n            //     _this.sortable()\n            // })\n            //console.log(res,'拖拽')\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"AA+GA;AACA;AACA;EACA;EACAA;IACA;IACAC;EACA;EACAC;IACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;QAAA;QACAC,WACA;UAAAC;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAF;QAAA,EACA;QACAZ,WACA;UAAAW;UAAAC;UAAAC;QAAA,EACA;QACAE,SACA;UAAAJ;UAAAC;UAAAC;QAAA,EACA;QACAf,SACA;UAAAa;UAAAC;UAAAC;QAAA;MAEA;MACAG;QACA;QACAC;QACA;QACA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;MACA;IACA;EACA;;EACAC;IACA;EACA;;EACAC;IACA;IACA;IACA;IACAC;IACA;IACA;IACAA;EACA;EACAC;IACAC;MACA;IACA;EACA;EACAC;IACAC;MACA;QACAC;UACAC;UACAhC;QACA;MACA;QACA;QACA;QACA;MACA;IACA;IACA;IACAiC;MACA;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACA;QACA;UACA;UACA;UACA;UACAC;YACAC;YACAX;UACA;UAEA;UACA;UACA;YACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA,kBACA;YACA;cACA;YACA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;QAEA;MACA;IACA;;IACA;IACAY;MACA;MACA;MACA;MACA;MACAC;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;QACAC;QACAC;QACA7B;MACA;QACA;UACA;YACA;YACA;YACA;UACA;YACA;UACA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MAEA;QACA;MACA;IAEA;IACA;IACA8B;MACA;MACA;MACA;MACAR;QACAC;QACAX;MACA;MACAW;MACAA;IACA;IACAQ;MACA;MACA;MACA;IAEA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC,oBAEA;IACA;IACAC;MACA;MACA1D;QACA;QACA2D;UAAAC;UAAAC;QAAA;UACA;UACA;UACA;YACApB;cACAqB;cACAC;cACAC;cACAJ;cACAC;YACA;YACA;UACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;UAEA;QACA;MACA;IACA;EAEA;AAEA","names":["components","Sortable","data","videolength","hide","show","keys","drag","hour","minute","second","chaTitle","tableData","dialogVisibleAdd","dialogVisibleEdit","dialogVisiblePlay","chaNunber","form","user","courseData","rules","chaIndex","required","message","trigger","type","chaUrl","video","url","muted","loop","preload","poster","volume","autoplay","mounted","created","console","computed","$video","methods","load","params","courseId","reast","addChapter","saveChapter","audio","that","handleClose","done","editChapter","deleteChapter","confirmButtonText","cancelButtonText","length","refresh","play","handleFullscreen","rowDrop","onEnd","newIndex","oldIndex","couId","pageNum","pageSize"],"sourceRoot":"src/views/Course","sources":["ChapterManager.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"chapter-top\">\r\n      <!-- 跳转到课程管理 -->\r\n      <el-page-header @back=\"$router.push('/course')\" :content=\"courseData.couName\"></el-page-header>\r\n\r\n      <div class=\"course-couIntroduction\">\r\n        <h3>{{courseData.couName}}</h3>\r\n        <p>课程介绍： {{courseData.couIntroduction}}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 章节 -->\r\n    <div class=\"chapter-bottom\">\r\n      <!-- 搜索 -->\r\n      <el-input style=\"width: 200px\" suffix-icon=\"el-icon-search\"  placeholder=\"请输入章节名称\" v-model=\"chaTitle\" @clear=\"load\" clearable></el-input>\r\n      <el-button style=\"margin-left: 10px\" type=\"primary\" @click=\"load\">搜索</el-button>\r\n      <!-- 刷新按钮 -->\r\n      <el-button size=\"mini\" style=\"margin-left: 10px\" type=\"primary\" @click=\"reast\"><i class=\"el-icon-refresh\"></i></el-button>\r\n      <!-- 新增章节按钮 -->\r\n      <el-button v-show=\"user.truename === courseData.teaName \" type=\"primary\" @click=\"addChapter\" >新增章节 <i class=\"el-icon-circle-plus-outline\"></i></el-button>\r\n      <!-- 章节详细表 -->\r\n      <el-table\r\n          :header-cell-style=\"{ backgroundColor: 'rgb(244, 244, 245)' }\"\r\n          row-key=\"id\"\r\n          :key=\"keys\"\r\n          :data=\"tableData\"\r\n          stripe border >\r\n\r\n        <el-table-column  prop=\"chaIndex' \" label=\"章节序号\" width=\"120\">\r\n          <template slot-scope=\"scope\">\r\n            第{{scope.row.chaIndex}}章\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"chaTitle\" label=\"章节名称\" width=\"180\"></el-table-column>\r\n        <el-table-column prop=\"chaTime\" label=\"章节时长\" width=\"180\">\r\n          <template slot-scope=\"scope\">\r\n            {{Math.floor(scope.row.chaTime / 3600)}}时\r\n            {{Math.floor( (scope.row.chaTime % 3600)/60 )}}分\r\n            {{scope.row.chaTime % 60}}秒\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"chaUrl\" label=\"视频地址\"></el-table-column>\r\n        <el-table-column prop=\"\" label=\"操作\" width=\"200\">\r\n          <template slot-scope=\"scope\">\r\n            <!-- 播放 -->\r\n            <el-button type=\"info\"  icon=\"el-icon-video-play\" @click=\"play(scope.row.chaUrl)\"></el-button>\r\n            <!-- 修改章节按钮 -->\r\n            <el-button v-show=\"user.truename === courseData.teaName \" type=\"primary\" @click=\"editChapter(scope.row)\" icon=\"el-icon-edit\"></el-button>\r\n\r\n            <!--  删除章节按钮 -->\r\n            <el-button v-show=\"user.truename === courseData.teaName \" type=\"danger\" icon=\"el-icon-delete\" @click=\"deleteChapter(scope.row.chaId)\"></el-button>\r\n          </template>\r\n        </el-table-column>\r\n\r\n      </el-table>\r\n\r\n\r\n    </div>\r\n\r\n    <!-- 新增章节弹窗 -->\r\n    <el-dialog\r\n        title=\"新增章节\"\r\n        @close=\"refresh\"\r\n        :visible.sync=\"dialogVisibleAdd\"\r\n        :before-close=\"handleClose\"\r\n        width=\"48%\" center>\r\n      <el-form  label-width=\"90px\" ref=\"chapterFrom\" :rules=\"rules\" :model=\"form\" :inline=\"true\">\r\n        <el-form-item  label=\"章节序号\" prop=\"chaIndex\" class=\"demo-form-inline\">\r\n          <el-input  v-model.number=\"form.chaIndex\" placeholder=\"请输入章节序号\" clearable autocomplete=\"off\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"章节名称\" prop=\"chaTitle\" class=\"demo-form-inline\" >\r\n          <el-input v-model=\"form.chaTitle\" placeholder=\"请输入章节名称\" clearable></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"视频地址\" prop=\"chaUrl\" style=\"\" class=\"demo-form-inline\">\r\n          <el-input v-model=\"form.chaUrl\" placeholder=\"请输入视频地址\" clearable></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"视频时长\" class=\"demo-form-inline\">\r\n          <el-button type=\"primary\"  v-if=\"show===true\" @click=\"length\">获取</el-button>\r\n          <el-input v-model=\"videolength\"  v-if=\"hide===true\" ></el-input>\r\n        </el-form-item>\r\n        <!-- <el-form-item label=\"视频时长\"   class=\"demo-form-inline\">\r\n            <el-input style=\"width: 45px;\" v-model=\"hour\"  /> 时\r\n            <el-input style=\"width: 45px;\" v-model=\"minute\"  /> 分\r\n            <el-input style=\"width: 45px;\" v-model=\"second\"  /> 秒\r\n\r\n        </el-form-item> -->\r\n        <!-- <el-form-item >\r\n            <el-input type=\"hidden\" v-model=\"form.courseId = courseData.couId\" ></el-input>\r\n        </el-form-item> -->\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"dialogVisibleAdd = false\">取 消</el-button>\r\n                <el-button type=\"primary\" @click=\"saveChapter\">确 定</el-button>\r\n            </span>\r\n    </el-dialog>\r\n\r\n    <!-- 播放 -->\r\n    <el-dialog\r\n        title=\"视频播放\"\r\n        :visible.sync=\"dialogVisiblePlay\"\r\n        width=\"58%\" center>\r\n      <div style=\"width: 99%;height: 400px\">\r\n        <vueMiniPlayer ref=\"vueMiniPlayer\" :video=\"video\" :mutex=\"true\" @fullscreen=\"handleFullscreen\" />\r\n      </div>\r\n    </el-dialog>\r\n\r\n\r\n  </div>\r\n</template>\r\n<script>\r\n//导入Sortable组件\r\nimport Sortable from 'sortablejs'\r\nexport default{\r\n  //注册Sortable组件\r\n  components: {\r\n    // eslint-disable-next-line vue/no-unused-components\r\n    Sortable\r\n  },\r\n  data () {\r\n    return {\r\n      videolength: 0,//视频时长\r\n      hide: '',//隐藏样式\r\n      show: '',//显示样式\r\n      keys:'',\r\n      drag:false,\r\n      hour:'',//时\r\n      minute: '',//分钟\r\n      second: '',//秒\r\n      chaTitle: '',//章节名称\r\n      tableData: [ ],\r\n      dialogVisibleAdd: false,//新增课程弹窗\r\n      dialogVisibleEdit: false,//修改课程弹窗\r\n      dialogVisiblePlay: false,//播放\r\n      chaNunber: 0,//章节数\r\n      form: {},\r\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\r\n      courseData: {},\r\n      rules:{//新增弹窗表单验证\r\n        chaIndex: [\r\n          {required: true, message: '请输入章节序号', trigger: 'blur'},\r\n          { type: 'number', message: '章节序号必须为数字值'}\r\n        ],\r\n        chaTitle: [\r\n          {required: true, message: '请输入章节名称', trigger: 'blur'},\r\n        ],\r\n        chaUrl: [\r\n          {required: true, message: '请输入视频地址', trigger: 'blur'},\r\n        ],\r\n        minute:[\r\n          {required: true, message: '请输入视频时长', trigger: 'blur'},\r\n        ]\r\n      },\r\n      video: {\r\n        // 视频播放源\r\n        url: '',\r\n        // 视频海报\r\n        // cover: 'https://i.loli.net/2019/06/06/5cf8c5d9c57b510947.png',\r\n        muted: false, // 是否静音播放\r\n        loop: false, // 视频是否循环播放\r\n        preload: 'auto', // 视频预加载\r\n        poster: '', // 原生视频默认海报暂不设置\r\n        volume: 1, // 默认音量\r\n        autoplay: false, // 视频自动播放\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    this.rowDrop()  //列表行拖拽后顺序数组\r\n  },\r\n  created(){\r\n    this.courseData = JSON.parse(this.$route.query.courseData)\r\n    this.chaNunber = this.courseData.couChaNum\r\n    this.hide=false\r\n    console.log(this.hide)\r\n    this.show=true\r\n    this.load()\r\n    console.log(this.courseData.teaName,this.user.truename)\r\n  },\r\n  computed:{\r\n    $video() {\r\n      return this.$refs.vueMiniPlayer.$video;\r\n    }\r\n  },\r\n  methods: {\r\n    load(){\r\n      this.request.get(\"/service-chapter/chapter/allchapter\",{\r\n        params:{\r\n          courseId: this.courseData.couId,\r\n          chaTitle: this.chaTitle,\r\n        }\r\n      }).then(res => {\r\n        //console.log(res,'res')\r\n        this.tableData = res.data\r\n        this.rowDrop()\r\n      })\r\n    },\r\n    //刷新\r\n    reast(){\r\n      this.chaTitle = ''\r\n      this.load()\r\n    },\r\n    //新增章节按钮\r\n    addChapter(){\r\n      this.dialogVisibleAdd = true;\r\n    },\r\n    //新增章节弹窗确定按钮\r\n    saveChapter(){\r\n      this.$refs['chapterFrom'].validate((valid) => {\r\n        if(valid){\r\n          var audio = new Audio( this.form.chaUrl)\r\n          let that = this\r\n          // eslint-disable-next-line no-unused-vars\r\n          audio.addEventListener(\"loadedmetadata\", function (e) {\r\n            that.form.chaTime = Math.floor(audio.duration)  // 通过添加监听来获取视频总时长字段，即duration\r\n            console.log('视频时长为', that.form.chaTime)\r\n          });\r\n\r\n          this.form.courseId = this.courseData.couId //课程id\r\n          //this.form.chaTime = this.hour*3600 + this.minute*60 + this.second*1,//视频时长\r\n          this.request.post(\"/service-chapter/chapter\",this.form).then(res => {\r\n            if(res.code === '200'){\r\n              this.dialogVisibleAdd = false;\r\n              this.$message.success(\"新增章节成功！！！\")\r\n              this.$refs[form].resetFields();\r\n              this.keys = Math.random()//用于改变key，使得视图重新渲染\r\n              this.load()\r\n              this.form = {}\r\n              this.hour = ''\r\n              this.minute = '',\r\n                  this.second = ''\r\n            }else{\r\n              this.$message.error(\"新增章节失败！！！\")\r\n            }\r\n          })\r\n\r\n          // //修改章节数\r\n          // if(!this.form.chaId){\r\n          //   this.chaNunber++\r\n          //   this.request.post(\"/service-course/course\",{\r\n          //     couId: this.courseData.couId,\r\n          //     couCataNum: this.chaNunber\r\n          //   }).then(res => {\r\n          //\r\n          //   })\r\n          // }\r\n\r\n        }\r\n      })\r\n    },\r\n    //新增章节弹窗关闭按钮\r\n    handleClose(done) {\r\n      this.form = {}\r\n      this.hour = ''\r\n      this.minute = ''\r\n      this.second = ''\r\n      done();\r\n    },\r\n    //修改章节按钮\r\n    editChapter(row){\r\n      this.form = row\r\n      this.hour = Math.floor(row.chaTime / 3600)\r\n      this.minute = Math.floor( (row.chaTime % 3600)/60 )\r\n      this.second = row.chaTime % 60\r\n      //console.log(row.chaTime,this.hour,this.minute,this.second)\r\n      this.dialogVisibleAdd = true\r\n    },\r\n    //删除章节按钮\r\n    deleteChapter(chaId){\r\n      this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        this.request.delete(\"/service-chapter/chapter/\" + chaId).then(res => {\r\n          if (res.code === '200') {\r\n            this.$message.success(\"删除成功！！！\")\r\n            this.keys = Math.random()//用于改变key，使得视图重新渲染\r\n            this.load()\r\n          } else {\r\n            this.$message.error(\"删除失败！！！！\")\r\n          }\r\n        })\r\n\r\n        //修改章节数\r\n        // this.chaNunber = this.chaNunber - 1\r\n        // //console.log(this.chaNunber,'删除章节数')\r\n        // this.request.post(\"/service-course/course\", {\r\n        //   couId: this.courseData.couId,\r\n        //   couCataNum: this.chaNunber\r\n        // }).then(res => {\r\n        //\r\n        // })\r\n\r\n      }).catch(() => {\r\n        this.$message.info(\"已取消删除\")\r\n      });\r\n\r\n    },\r\n    //获取视频时长\r\n    length(){\r\n      var audio = new Audio(this.form.chaUrl)\r\n      let that = this\r\n      // eslint-disable-next-line no-unused-vars\r\n      audio.addEventListener(\"loadedmetadata\", function (e) {\r\n        that.videolength = Math.floor(audio.duration)  // 通过添加监听来获取视频总时长字段，即duration\r\n        console.log('视频时长为:' ,that.videolength)\r\n      });\r\n      that.show = false\r\n      that.hide=true\r\n    },\r\n    refresh(){\r\n      this.show = true\r\n      this.hide=false\r\n      this.$refs[formRef].resetFields();\r\n\r\n    },\r\n    //播放\r\n    play(chaUrl){\r\n      this.dialogVisiblePlay = true\r\n      this.video.url = chaUrl\r\n    },\r\n    //视频播放\r\n    handleFullscreen(){\r\n\r\n    },\r\n    // 行拖拽\r\n    rowDrop () {\r\n      const tbody = document.querySelector('.el-table__body-wrapper tbody')\r\n      Sortable.create(tbody, {\r\n        // filter: '.filtered',\r\n        onEnd: ({ newIndex, oldIndex }) => {\r\n          // handle: '.allowDray'\r\n          // console.log(`newIndex=${newIndex}`,`oldIndex=${oldIndex}`)\r\n          this.request.get(\"/service-chapter/chapter/drag\",{\r\n            params: {\r\n              couId: this.courseData.couId,\r\n              pageNum: this.pageNum,\r\n              pageSize: this.pageSize,\r\n              newIndex: newIndex,\r\n              oldIndex: oldIndex\r\n            }\r\n            // eslint-disable-next-line no-unused-vars\r\n          }).then(res => {\r\n            this.keys = Math.random()//用于改变key，使得视图重新渲染\r\n            this.load()\r\n            // _this.$nextTick(() => {\r\n            //     //重新初始化\r\n            //     _this.sortable()\r\n            // })\r\n            //console.log(res,'拖拽')\r\n\r\n          })\r\n        }\r\n      })\r\n    },\r\n\r\n  }\r\n\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.block{\r\n  margin-top: 20px;\r\n}\r\n.chapter-top{\r\n  margin-top: -10px;\r\n  .el-page-header{\r\n    margin-bottom: 20px;\r\n  }\r\n  .course-couIntroduction{\r\n    width: 80%;\r\n    margin: auto;\r\n    h3{\r\n      text-align: center;\r\n      line-height: 30px;\r\n    }\r\n    p{\r\n      margin-top: 15px;\r\n      line-height: 30px;\r\n      color: rgb(79, 78, 78);\r\n    }\r\n  }\r\n}\r\n.chapter-bottom{\r\n  width: 80%;\r\n  margin: auto;\r\n  .demo-form-inline{\r\n    margin-top: 20px;\r\n  }\r\n  /deep/.el-table{\r\n    margin-top: 20px;\r\n    .cell {\r\n      display: -webkit-box;\r\n      -webkit-box-orient: vertical;\r\n      -webkit-line-clamp: 1;\r\n    }\r\n  }\r\n}\r\n.el-form{\r\n  .el-form--inline .el-form-item{\r\n    margin-right: 0;\r\n  }\r\n\r\n}\r\n/deep/._time-current {\r\n  width: 50px;\r\n}\r\n\r\n/deep/ ._time-amount {\r\n  width: 50px;\r\n}\r\n\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}